# EasyExcel简介与核心优势

EasyExcel 是一个基于 Java 的开源 Excel 操作工具，由阿里巴巴开发并开源，旨在简化 Excel 文件的读写操作。它基于 Apache POI 进行了优化，提供了更高的性能和更低的内存消耗，特别适合处理大数据量的 Excel 文件。本篇博客将详细介绍 EasyExcel 的核心优势，包括内存优化（基于 SAX 解析）、支持大文件读写、注解式编程模型，并结合代码实战展示其使用方法。

## EasyExcel 简介

EasyExcel 是对 Apache POI 的封装和优化，解决了传统 POI 在处理大文件时内存占用高、性能低的问题。它通过流式处理和注解驱动的方式，极大简化了 Excel 文件的操作，广泛应用于企业级报表生成、数据导入导出等场景。EasyExcel 支持 Excel 2003（xls）和 Excel 2007（xlsx）格式，且兼容性良好。

## 核心优势

### 1. 内存优化（基于 SAX 解析）

EasyExcel 的核心优势之一是其内存优化能力。传统 Apache POI 使用 DOM 解析方式，会将整个 Excel 文件加载到内存中，导致大数据量文件处理时容易发生 OutOfMemoryError。而 EasyExcel 基于 SAX（Simple API for XML）解析方式，采用流式读取，通过逐行解析 Excel 文件，显著降低了内存占用。

- **SAX 解析原理**：SAX 是一种事件驱动的解析方式，EasyExcel 在读取 Excel 时不会一次性加载整个文件，而是通过监听器逐行处理数据。每次只在内存中保留当前行数据，解析完成后立即释放，适合处理超大文件。

- 优势

  ：

  - **低内存占用**：即使处理上百万行数据的 Excel 文件，内存占用也能控制在几十 MB。
  - **高效性能**：流式处理避免了大量对象创建和垃圾回收，提高了读写效率。

### 2. 支持大文件读写

EasyExcel 针对大文件读写场景进行了深度优化，无论是导出还是导入，都能高效处理。

- **大文件导出**：通过分片写入和缓存机制，EasyExcel 支持将大数据量分批写入 Excel 文件，避免内存溢出。例如，导出百万级数据时，可以设置分片大小，逐批写入。
- **大文件读取**：通过 SAX 解析，EasyExcel 可以逐行读取数据，开发者只需实现监听器接口，处理每行数据即可。
- **多 Sheet 支持**：EasyExcel 支持多 Sheet 操作，适合复杂报表场景。

### 3. 注解式编程模型

EasyExcel 提供了简洁的注解式编程模型，通过简单的 Java 注解即可完成 Excel 字段映射和样式配置，极大降低了开发复杂度。

- 核心注解

  ：

  - `@ExcelProperty`：指定 Java 属性与 Excel 列的映射关系，支持自定义列名和列顺序。
  - `@ExcelIgnore`：忽略不需要导出的字段。
  - `@ColumnWidth` 和 `@HeadStyle`：设置列宽和表头样式，方便定制化输出。

- 优势

  ：

  - **代码简洁**：通过注解定义映射关系，无需手动编写繁琐的 POI 代码。
  - **灵活性高**：支持动态表头、复杂表头（如合并单元格）等高级功能。
  - **易于维护**：基于 POJO（Plain Old Java Object）模型，代码结构清晰，维护成本低。

## 代码实战

下面通过一个完整的代码示例，展示如何使用 EasyExcel 实现 Excel 文件的读写操作。我们以一个学生信息表为例，包含姓名、年龄和学号字段。

### 环境准备

首先，引入 EasyExcel 依赖（以 Maven 为例）：

```xml
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>easyexcel</artifactId>
    <version>3.3.2</version>
</dependency>
```

### 示例代码

#### 1. 定义实体类

创建一个 `Student` 类，使用注解定义 Excel 列的映射关系：

```java
import com.alibaba.excel.annotation.ExcelProperty;
import com.alibaba.excel.annotation.write.ColumnWidth;
import com.alibaba.excel.annotation.write.HeadStyle;
import com.alibaba.excel.enums.poi.FillPatternTypeEnum;
import lombok.Data;

@Data
public class Student {
    @ExcelProperty("姓名")
    @ColumnWidth(20)
    @HeadStyle(fillPatternType = FillPatternTypeEnum.SOLID_FOREGROUND, fillForegroundColor = 22)
    private String name;

    @ExcelProperty("年龄")
    @ColumnWidth(10)
    private Integer age;

    @ExcelProperty("学号")
    @ColumnWidth(15)
    private String studentId;
}
```

#### 2. 导出 Excel

通过 EasyExcel 导出学生信息到 Excel 文件：

```java
import com.alibaba.excel.EasyExcel;
import java.util.ArrayList;
import java.util.List;

public class EasyExcelWriteDemo {
    public static void main(String[] args) {
        // 准备数据
        List<Student> students = new ArrayList<>();
        students.add(new Student("张三", 20, "S001"));
        students.add(new Student("李四", 21, "S002"));
        students.add(new Student("王五", 19, "S003"));

        // 导出到 Excel
        String fileName = "students.xlsx";
        EasyExcel.write(fileName, Student.class)
                .sheet("学生信息")
                .doWrite(students);
    }
}
```

运行后，会生成一个 `students.xlsx` 文件，包含表头和学生数据，表头样式和列宽按照注解配置自动应用。

#### 3. 读取 Excel

实现一个监听器，用于逐行读取 Excel 数据：

```java
import com.alibaba.excel.context.AnalysisContext;
import com.alibaba.excel.read.listener.PageReadListener;

public class EasyExcelReadDemo {
    public static void main(String[] args) {
        String fileName = "students.xlsx";
        EasyExcel.read(fileName, Student.class, new PageReadListener<Student>() {
            @Override
            public void invoke(Student student, AnalysisContext context) {
                System.out.println("读取到数据: " + student);
            }
        }).sheet().doRead();
    }
}
```

运行后，程序会逐行读取 `students.xlsx` 文件，并打印每行数据。

### 运行结果

- **导出结果**：生成一个格式美观的 Excel 文件，包含表头“姓名”、“年龄”、“学号”和对应的数据。

- 读取结果

  ：控制台输出每行学生信息，例如：

  ```
  读取到数据: Student(name=张三, age=20, studentId=S001)
  读取到数据: Student(name=李四, age=21, studentId=S002)
  读取到数据: Student(name=王五, age=19, studentId=S003)
  ```

## 总结

EasyExcel 凭借其内存优化（基于 SAX 解析）、支持大文件读写和注解式编程模型，成为 Java 开发中处理 Excel 文件的优选工具。它在性能、易用性和灵活性上都表现出色，尤其适合企业级应用场景。通过上述代码实战，开发者可以快速上手 EasyExcel，实现高效的 Excel 操作。